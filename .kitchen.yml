---
platforms:
  - name: debian-7
    transport:
      username: admin
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-debian-7
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: debian-7
  - name: debian-8
    transport:
      username: admin
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-debian-8
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: debian-8
  - name: centos-6
    transport:
      username: centos
    # Ruby 2.0 is installed in custom location. Override these calls to ensure
    # that serverspec can be installed and run (otherwise it won't be found)
    verifier:
      bundler_path: /opt/rh/ruby200/root/usr/local/bin
      rspec_path: /opt/rh/ruby200/root/usr/local/bin
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-centos-6
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: centos-6
  - name: centos-7
    transport:
      username: centos
    verifier:
      bundler_path: /opt/rh/ruby200/root/usr/local/bin
      rspec_path: /opt/rh/ruby200/root/usr/local/bin
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-centos-7
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: centos-7
  - name: ubuntu-14.04
    transport:
      username: ubuntu
    # The Omnibus provisioner doesn't work correctly on Ubuntu boxes atm
    provisioner:
      require_ansible_omnibus: false
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-ubuntu-1404
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: ubuntu-14.04
  - name: ubuntu-16.04
    transport:
      username: ubuntu
    provisioner:
      require_ansible_omnibus: false
    driver:
      tags:
        Name: ansible-test-kitchen-role-elasticsearch-ubuntu-1604
        CreatedBy: test-kitchen
        TestKitchenRole: elasticsearch
        TestKitchenPlatform: ubuntu-16.04

suites:
  - name: elasticsearch
    excludes:
      - debian-8
      - centos-6
      - ubuntu-14.04
      - ubuntu-16.04
    verifier:
      patterns:
        - "roles/*/test/integration/elasticsearch/serverspec/*_spec.rb"

provisioner:
  name: ansible_playbook
  hosts: all
  requirements_path: test/requirements.yml
  require_ansible_omnibus: true
  require_ruby_for_busser: true
  require_chef_for_busser: false

verifier:
  name: serverspec
  sudo_path: true
